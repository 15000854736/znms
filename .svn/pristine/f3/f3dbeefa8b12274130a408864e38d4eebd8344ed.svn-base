<%--
  Created by IntelliJ IDEA.
  User: shenqilei
  Date: 2016/11/30
  Time: 17:45
  To change this template use File | Settings | File Templates.
--%>
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/fmt" prefix="fmt"%>
<%
    String path=request.getContextPath();
%>
<script>


    //散列半径
    var radius = ${radius};
    //散列系数 1个在线用户散列几个点
    var countScale = ${countScale};
    //散列点尺寸
    var pointSize = ${pointSize};

    var myChart;

    function getStarMapBgScale(){
        var scale =1;

        var logo_height = ${logoHeight};
        if(logo_height>50){
            logo_height=50;
        }

        var screenWidth  = winWidth;
        var screenHeight = winHeight-logo_height;

        var starMapWidth = ${starMapBgWidth};
        var starMapHeight = ${starMapBgHeight};

        var widthScale = screenWidth/starMapWidth;
        var heightScale = screenHeight/starMapHeight;

        if(widthScale>heightScale){
            scale = heightScale;
        }else{
            scale = widthScale;
        }

        return scale;
    }

    //随机散列点
    function randomPoint(r, ox, oy, count){
        var data = [];
        for( i = 0; i < count; i++){

            var x_direction = Math.round(Math.random());
            var y_direction = Math.round(Math.random());

            var x,y;

            if(x_direction>0){
                x = Math.floor(Math.random()*r)+1+ox
            }else{
                x = ox-(Math.floor(Math.random()*r)+1);
            }

            if(y_direction>0){
                y = Math.floor(Math.random()*r)+1+oy
            }else{
                y = oy-(Math.floor(Math.random()*r)+1);
            }

            data.unshift({x:x,y:y});
        }
        return data;
    }

    function generatePoint(apData){
        var data = [];

        for(var i=0;i<apData.length;i++){
            var x=apData[i].x;
            var y=apData[i].y;
            data.push([
                x,
                y
            ]);
            var random_data = randomPoint(radius,x,y, Math.round(countScale*apData[i].value));
            for(var k=0;k<random_data.length;k++) {
                var xvalue=random_data[k].x;
                var yvalue=random_data[k].y;
                data.push([xvalue ,yvalue]);
            }
        }

        return data;
    }


    function refreshStarMap() {
        $.ajax({
            type:'POST',
            url:'<%=path%>/screen/module/starMap/getApData',
            cache:false,
            success:function(apData){

                var data = generatePoint(apData);

                myChart.setOption({
                    series : [
                        {
                            name:'ap',
                            type:'scatter',
                            large: true,
                            showEffectOn: 'render',
                            rippleEffect: {
                                brushType: 'stroke'
                            },
                            itemStyle: {
                                normal: {
                                    shadowBlur: 10,
                                    shadowColor: 'rgba(14, 241, 242, 0.8)',
                                    color: 'rgba(14, 241, 242, 0.8)'
                                }
                            },
                            symbolSize: pointSize,
                            data:data
                        }
                    ]
                });


            }
        });
    }

    /**
     * 全屏时调用
     */
    function showFullScreen_starMap(){
        console.log("invoke showFullScreen_starMap");
        //计算背景图缩放比例
        var scale = getStarMapBgScale();
        var mapWidth = scale*${starMapBgWidth};
        var mapHeight = scale*${starMapBgHeight};


        $("#star_map").height(mapHeight);
        $("#star_map").width(mapWidth);

        myChart = echarts.init(document.getElementById("star_map"));
        //console.log("myChart:"+myChart);
        $.ajax({
            type:'POST',
            url:'<%=path%>/screen/module/starMap/getApData',
            cache:false,
            success:function(apData){

                var img = new Image();
                img.src = "image/SCHOOL-BG.png";

                var canvas = document.createElement("canvas");
                canvas.width =  mapWidth;
                canvas.height = mapHeight;
                var context =canvas.getContext("2d");
                context.scale(scale,scale);//设置缩放比例
                context.drawImage(img, 0, 0);

                //坐标点
                var data = generatePoint(apData);

                var option = {
                    animation:false,
                    backgroundColor: {
                        type: "pattern",
                        repeat: "no-repeat",
                        image: canvas,
                    },
                    grid: {
                        x: 0,
                        y: 0,
                        x2:mapWidth,
                        y2:mapHeight,
                        bottom:0,
                        left:0,
                        top:0,
                        right:0
                    },
                    toolbox: {
                        show : false,
                        feature : {
                            mark : {show: true},
                            dataZoom : {show: true},
                            dataView : {show: true, readOnly: false},
                            restore : {show: true},
                            saveAsImage : {show: true}
                        }
                    },
                    xAxis : [
                        {

                            min:'0',
                            max: img.width,
                            inverse:false,
                            //axisLabel :false,
                            axisLine :false,
                            splitLine :false,
                            type : 'value',
                            scale:false
                        }
                    ],
                    yAxis : [
                        {

                            min:'0',
                            max: img.height,
                            inverse:true,
                            axisLine :false,
                            splitLine :false,
                            type : 'value',
                            scale:false
                        }
                    ],
                    series : [
                        {
                            name:'ap',
                            type:'scatter',
                            large: true,
                            showEffectOn: 'render',
                            rippleEffect: {
                                brushType: 'stroke'
                            },
                            itemStyle: {
                                normal: {
                                    shadowBlur: 10,
                                    shadowColor: 'rgba(14, 241, 242, 0.8)',
                                    color: 'rgba(14, 241, 242, 0.8)'
                                }
                            },
                            symbolSize: pointSize,
                            data:data
                        }
                    ],
                    itemStyle: {
                        normal: {
                            color: '#0FD6D7'
                        }
                    }
                };
                myChart.setOption(option);


                //设置刷新
                refreshHander_1 = setInterval(function(){
                    refreshStarMap();
                }, 60*1000);
            }
        });
    }

</script>
<div id="star_map_container">
    <div id="star_map" class="L">

    </div>
    <table width="0" border="0" cellspacing="0" cellpadding="0" class="sm_star_right_menu">
        <tr>
            <td class="sm_width_50b sm_height_15b"  ><div class="sm_adapt_mod sm_fontcol_f60"><i class="sm_online_no"></i><p class="led_fonts sm_font_2vw">1234</p><p>在线数</p></div></td>
            <td class="sm_width_50b"><div class="sm_adapt_mod sm_fontcol_9f0"><i class="sm_online_ap_no"></i><p class="led_fonts sm_font_2vw">1234</p><p>在线数</p></div></td>
        </tr>
        <tr>
            <td colspan="2" class="sm_height_35b">
                <h1 class="sm_title_h">有线/无线比例</h1>
                <ul class="sm_wired_wireless">
                    <li><div class="sm_data_amod"><img src="<%=path%>/images/screen/module/starMap/1.png" ></div><div class="sm_adapt_mod sm_wired_9f0"><i class="sm_wired_no"></i><p class="led_fonts sm_font_2vw">1234</p><p>无线</p></div></li>
                    <li><div class="sm_data_amod"><img src="<%=path%>/images/screen/module/starMap/2.png" ></div><div class="sm_adapt_mod sm_wireless_c90"><i class="sm_wireless_no"></i><p class="led_fonts sm_font_2vw">1234</p><p>有线</p></div></li>
                </ul></td>
        </tr>
        <tr>
            <td colspan="2"  class="sm_height_15b">  <ul class="sm_wired_wireless">
                <li><div class="sm_adapt_mod sm_wired1x_0cf"><i class="sm_wired1x_no"></i><p class="led_fonts sm_font_2vw">1234</p><p>无线1x</p></div></li>
                <li><div class="sm_adapt_mod sm_portal_ff0"><i class="sm_portal_no"></i><p class="led_fonts sm_font_2vw">1234</p><p>无线Portal</p></div></li>
            </ul></td>
            </td>
        </tr>
        <tr>
            <td colspan="2" class="sm_height_35b">
                <h1 class="sm_title_h">有线/无线比例</h1>
                <div class="sm_text_center"><img src="<%=path%>/images/screen/module/starMap/3.png" width="49%" height="10%" ></div>
                <ul class="sm_wired_wireless sm_terminal">
                    <li><div class="sm_adapt_mod sm_apple_ccc"><i class="sm_apple_no"></i><p class="led_fonts sm_font_2vw">1234</p><p>无线1x</p></div></li>
                    <li><div class="sm_adapt_mod sm_android_9f0"><i class="sm_android_no"></i><p class="led_fonts sm_font_2vw">1234</p><p>无线Portal</p></div></li>
                    <li><div class="sm_adapt_mod sm_pc_0cf"><i class="sm_pc_no"></i><p class="led_fonts sm_font_2vw">1234</p><p>无线Portal</p></div></li>
                </ul></td>
        </tr>
    </table>
</div>


