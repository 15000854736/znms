package info.zznet.znms.web.start;

import info.zznet.znms.base.common.ZNMSLogger;
import info.zznet.znms.base.dao.HostMapper;
import info.zznet.znms.base.entity.Host;
import info.zznet.znms.base.util.SpringContextUtil;
import info.zznet.znms.spider.Engine;

import java.util.HashMap;
import java.util.List;
import java.util.Map;

import org.apache.log4j.Logger;

public class SystemStartThread extends Thread {
	private static Logger logger = Logger.getLogger(SystemStartThread.class);
	
	public static Map<String, Host> hostMap = new HashMap<String, Host>();
	public void run(){
		try{
			
			Engine engine = (Engine) SpringContextUtil.getBean("engine");
//			engine.startRrdExecutor();
			HostMapper hostMapper = (HostMapper)SpringContextUtil.getBean("hostMapper");
			List<Host> hostList = hostMapper.findAll();
			for (Host host : hostList) {
				hostMap.put(host.getHostIp(), host);
			}
			
			//启动阀值触发线程
			ThresholdValueThread valueThread = new ThresholdValueThread();
			valueThread.start();
			ZNMSLogger.showOnConsole("=====Z-NMS Started=====");
			ZNMSLogger.info("启动Z-NMS成功！");
		}
		catch(Throwable t) {
			ZNMSLogger.error(t);
			ZNMSLogger.warn("Z-NMS系统启动失败,推出系统！");
			System.exit(0);
		}
	}
	
	public void shutDown() {

	}
}
