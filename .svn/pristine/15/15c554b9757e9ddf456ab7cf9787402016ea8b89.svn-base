package info.zznet.znms.web.module.screen.controller;

import java.io.IOException;
import java.util.HashMap;
import java.util.Map;

import info.zznet.znms.base.common.ZNMSLogger;
import info.zznet.znms.base.constants.PermissionConstants;
import info.zznet.znms.base.util.HttpClientUtil;
import info.zznet.znms.web.WebRuntimeData;
import info.zznet.znms.web.annotation.CheckPermission;
import info.zznet.znms.web.util.ApiClientUtil;
import net.sf.json.JSONObject;

import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.ResponseBody;
import org.springframework.web.servlet.ModelAndView;

@Controller
@RequestMapping("/screen/module/accessTimeAnalysis")
public class ScreenAccessTimeAnalysisController {
	
	private WebRuntimeData webRuntimeData = WebRuntimeData.instance;
	
 	@RequestMapping({"","/"})
    @CheckPermission(PermissionConstants.P_SCREEN_VIEW)
    public ModelAndView init(){
        ModelAndView mav = new ModelAndView("/screen/module/accessTimeAnalysis/index");

        return mav;
    }
 	
 	
 	@RequestMapping(value = "/getAccessTime", method = RequestMethod.POST, produces = {"application/json;charset=UTF-8"})
 	@ResponseBody
 	public String getAccessTime(){
 	   
		try {
			String zlogIp=webRuntimeData.getSystemOptionBean().getZlogIp();
			String zlogPort=webRuntimeData.getSystemOptionBean().getZlogPort();
			Map<String,String> paramMap=new HashMap<String, String>();
			paramMap.put("from", "1481472000000");
			paramMap.put("to", "1481558399998");
			ApiClientUtil apiClientUtil=new ApiClientUtil("http://"+zlogIp+":"+zlogPort+"/z-log/api/rest/getOnlineAnalyzeResult");
			apiClientUtil.post(paramMap);
			String zlogresponse="{\"onlineDetail\":{\"教师\":{\"etcOnlineTimePerDay\":0,\"etcOnlineTimePerRecord\":0,\"pcOnlineTimePerDay\":7.080268,\"pcOnlineTimePerRecord\":6.076185,\"wirelessOnlineTimePerDay\":23.575,\"wirelessOnlineTimePerRecord\":15.716666},\"学生\":{\"etcOnlineTimePerDay\":0,\"etcOnlineTimePerRecord\":0,\"pcOnlineTimePerDay\":7.080268,\"pcOnlineTimePerRecord\":6.076185,\"wirelessOnlineTimePerDay\":23.575,\"wirelessOnlineTimePerRecord\":15.716666}},\"flow\":{\"教师\":{\"etcFlowPerDay\":0,\"etcFlowPerRecord\":0,\"pcFlowPerDay\":0,\"pcFlowPerRecord\":0,\"wirelessFlowPerDay\":0,\"wirelessFlowPerRecord\":0},\"学生\":{\"etcFlowPerDay\":0,\"etcFlowPerRecord\":0,\"pcFlowPerDay\":0,\"pcFlowPerRecord\":0,\"wirelessFlowPerDay\":0,\"wirelessFlowPerRecord\":0}}}";
			
			JSONObject zlogJsonObject=JSONObject.fromObject(zlogresponse);
			
			return zlogJsonObject.toString();
		} catch (IOException e) {
			ZNMSLogger.error("Failed to get data from zos,"+e.getMessage());
		}
		return null;
 	}
 	
}
