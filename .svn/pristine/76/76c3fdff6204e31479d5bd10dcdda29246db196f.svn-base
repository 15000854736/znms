package info.zznet.znms.base.job;

import info.zznet.znms.base.entity.ApInformation;
import info.zznet.znms.web.module.apInformation.service.ApInformationService;

import java.text.DateFormat;
import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.util.Calendar;
import java.util.Date;
import java.util.List;

import org.quartz.DisallowConcurrentExecution;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.scheduling.annotation.Scheduled;
import org.springframework.stereotype.Service;



@Service
@DisallowConcurrentExecution
public class DeleteAPJob {
	
	@Autowired
	private ApInformationService apInformationService;
	
	
	@Scheduled(initialDelay = 60 * 60 * 1000,fixedDelay = 24*60*60*1000)
	public void deleteAp(){
		
		try {
			List<ApInformation>  apInformations=apInformationService.findAll();
			for (ApInformation apInformation : apInformations) {
				int num=daysBetween(apInformation.getLastUpdateTime());
				if(num>=15){
					apInformationService.deleteByPrimaryKey(apInformation.getApInformationUuid());
				}
			}
		} catch (ParseException e) {
		}
	}
	  /**
	   * 计算当前日期跟指定日期的天数
	   * @param date
	   * @return
	   * @throws ParseException
	   */
	  public static int daysBetween(Date date) throws ParseException{  
	        Calendar cal = Calendar.getInstance();    
	        cal.setTime(new Date());    
	        long time1 = cal.getTimeInMillis();                 
	        cal.setTime(date);    
	        long time2 = cal.getTimeInMillis();         
	        long between_days=(time2-time1)/(1000*3600*24);  
	       return Integer.parseInt(String.valueOf(between_days));     
	    }   
}
