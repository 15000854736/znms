/**
 * 
 */
package info.zznet.znms.web.module.apInformation.controller;

import info.zznet.znms.base.common.BaseController;
import info.zznet.znms.base.constants.PermissionConstants;
import info.zznet.znms.base.entity.ApInformation;
import info.zznet.znms.web.annotation.CheckPermission;
import info.zznet.znms.web.module.apInformation.service.ApInformationService;
import info.zznet.znms.web.module.system.service.SystemOptionService;

import java.util.List;

import net.sf.json.JSONArray;
import net.sf.json.JSONObject;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.ResponseBody;
import org.springframework.web.servlet.ModelAndView;

/**
 * AP信息controller
 * @author dell001
 *
 */
@RequestMapping("/apInformation")
@Controller
public class ApInformationController extends BaseController{

	@Autowired
	private ApInformationService apInformationService;
	
	@Autowired
	private SystemOptionService systemOptionService;
	
	private static final String VIEW_MAIN = "apInformation/apInformation_main";
	
	/**
	 * 跳转到主页面
	 * @return
	 */
	@RequestMapping("")
	@CheckPermission(PermissionConstants.P_AP_INFORMATION_VIEW)
	public ModelAndView init(){
		//return new ModelAndView(VIEW_MAIN).addObject("apMapPath", SystemConstants.AP_MAP_PATH+"/"+map.getApMapName());
		return new ModelAndView(VIEW_MAIN).addObject("apMapPath", systemOptionService.selectBySystemOperatorKey("SCHOOL-BG"));
	}
	
	/**
	 * 根据ac和ap名称查找ap
	 * @param acIp
	 * @param apName
	 * @return
	 */
	@RequestMapping(value = "/findApByCondition", method = RequestMethod.POST)
	@ResponseBody
	public String findApByCondition(@RequestParam("acIp")String acIp, @RequestParam("apName")String apName,
			@RequestParam("apPositionStatus")int apPositionStatus){
		List<ApInformation> list = apInformationService.findApByCondition(acIp, apName, apPositionStatus);
		return JSONArray.fromObject(list).toString();
	}
	
	/**
	 * 设置ap位置
	 * @param apInformationUuid
	 * @param apAxis
	 * @return
	 */
	@RequestMapping(value = "/changePosition", method = RequestMethod.POST)
	@ResponseBody
	public String changePosition(@RequestParam("apInformationUuid")String apInformationUuid, 
			@RequestParam("apAxis")String apAxis){
		apInformationService.update(apInformationUuid, apAxis);
		return "{\"reslu\":true}";
	}
	
	/**
	 * 查找ap信息
	 * @param apInformationUuid
	 * @return
	 */
	@RequestMapping(value = "/findApAxis", method = RequestMethod.POST)
	@ResponseBody
	public String findApAxis(@RequestParam("apInformationUuid")String apInformationUuid){
		ApInformation apInformation = apInformationService.selectByPrimaryKey(apInformationUuid);
		return JSONObject.fromObject(apInformation).toString();
	}
}
